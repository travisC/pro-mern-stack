{"version":3,"sources":["webpack:///./server/server.js?268d"],"names":["app","use","static","json","db","get","req","res","filter","query","status","effort_lte","effort_gte","effort","$lte","parseInt","$gte","_summary","undefined","offset","_offset","limit","_limit","cursor","collection","find","sort","_id","skip","totalCount","count","then","result","toArray","issues","metadata","records","catch","error","console","log","message","aggregate","$match","$group","owner","$sum","results","stats","forEach","post","newIssue","body","created","Date","err","validateIssue","insertOne","cleanupIssue","insertedId","next","savedIssue","issueId","params","id","issue","put","updateOne","convertIssue","delete","deleteOne","deleteResult","n","setDb","newDb"],"mappings":"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","file":"0.b14772431833caa553ba.hot-update.js","sourcesContent":["import express from 'express';\nimport bodyParser from 'body-parser';\nimport { ObjectId } from 'mongodb';\nimport Issue from './issue.js';\nimport renderedPageRouter from './renderedPageRouter.jsx';\n\nconst app = express();\napp.use(express.static('static'));\napp.use(bodyParser.json());\n\nlet db;\n\napp.get('/api/issues', (req, res) => {\n  const filter = {};\n  if (req.query.status) filter.status = req.query.status;\n  if (req.query.effort_lte || req.query.effort_gte) filter.effort = {};\n  if (req.query.effort_lte) filter.effort.$lte = parseInt(req.query.effort_lte, 10);\n  if (req.query.effort_gte) filter.effort.$gte = parseInt(req.query.effort_gte, 10);\n\n  if (req.query._summary === undefined) {\n    const offset = req.query._offset ? parseInt(req.query._offset, 10) : 0;\n    let limit = req.query._limit ? parseInt(req.query._limit, 10) : 20;\n    if (limit > 50) limit = 50;\n\n    const cursor = db.collection('issues').find(filter).sort({ _id: 1 })\n    .skip(offset)\n    .limit(limit);\n\n    let totalCount;\n    cursor.count(false).then(result => {\n      totalCount = result;\n      return cursor.toArray();\n    })\n    .then(issues => {\n      res.json({ metadata: { totalCount }, records: issues });\n    })\n    .catch(error => {\n      console.log(error);\n      res.status(500).json({ message: `Internal Server Error: ${error}` });\n    });\n  } else {\n    db.collection('issues').aggregate([\n      { $match: filter },\n      { $group: { _id: { owner: '$owner', status: '$status' }, count: { $sum: 1 } } },\n    ]).toArray()\n    .then(results => {\n      const stats = {};\n      results.forEach(result => {\n        if (!stats[result._id.owner]) stats[result._id.owner] = {};\n        stats[result._id.owner][result._id.status] = result.count;\n      });\n      res.json(stats);\n    })\n    .catch(error => {\n      console.log(error);\n      res.status(500).json({ message: `Internal Server Error: ${error}` });\n    });\n  }\n});\n\napp.post('/api/issues', (req, res) => {\n  const newIssue = req.body;\n  newIssue.created = new Date();\n  if (!newIssue.status) {\n    newIssue.status = 'New';\n  }\n\n  const err = Issue.validateIssue(newIssue);\n  if (err) {\n    res.status(422).json({ message: `Invalid request: ${err}` });\n    return;\n  }\n\n  db.collection('issues').insertOne(Issue.cleanupIssue(newIssue)).then(result =>\n    db.collection('issues').find({ _id: result.insertedId }).limit(1)\n    .next()\n  )\n  .then(savedIssue => {\n    res.json(savedIssue);\n  })\n  .catch(error => {\n    console.log(error);\n    res.status(500).json({ message: `Internal Server Error: ${error}` });\n  });\n});\n\napp.get('/api/issues/:id', (req, res) => {\n  let issueId;\n  try {\n    issueId = new ObjectId(req.params.id);\n  } catch (error) {\n    res.status(422).json({ message: `Invalid issue ID format: ${error}` });\n    return;\n  }\n\n  db.collection('issues').find({ _id: issueId }).limit(1)\n  .next()\n  .then(issue => {\n    if (!issue) res.status(404).json({ message: `No such issue: ${issueId}` });\n    else res.json(issue);\n  })\n  .catch(error => {\n    console.log(error);\n    res.status(500).json({ message: `Internal Server Error: ${error}` });\n  });\n});\n\napp.put('/api/issues/:id', (req, res) => {\n  let issueId;\n  try {\n    issueId = new ObjectId(req.params.id);\n  } catch (error) {\n    res.status(422).json({ message: `Invalid issue ID format: ${error}` });\n    return;\n  }\n\n  const issue = req.body;\n  delete issue._id;\n\n  const err = Issue.validateIssue(issue);\n  if (err) {\n    res.status(422).json({ message: `Invalid request: ${err}` });\n    return;\n  }\n\n  db.collection('issues').updateOne({ _id: issueId }, Issue.convertIssue(issue)).then(() =>\n    db.collection('issues').find({ _id: issueId }).limit(1)\n    .next()\n  )\n  .then(savedIssue => {\n    res.json(savedIssue);\n  })\n  .catch(error => {\n    console.log(error);\n    res.status(500).json({ message: `Internal Server Error: ${error}` });\n  });\n});\n\napp.delete('/api/issues/:id', (req, res) => {\n  let issueId;\n  try {\n    issueId = new ObjectId(req.params.id);\n  } catch (error) {\n    res.status(422).json({ message: `Invalid issue ID format: ${error}` });\n    return;\n  }\n\n  db.collection('issues').deleteOne({ _id: issueId }).then((deleteResult) => {\n    if (deleteResult.result.n === 1) res.json({ status: 'OK' });\n    else res.json({ status: 'Warning: object not found' });\n  })\n  .catch(error => {\n    console.log(error);\n    res.status(500).json({ message: `Internal Server Error: ${error}` });\n  });\n});\n\napp.use('/', renderedPageRouter);\n\nfunction setDb(newDb) {\n  db = newDb;\n}\n\nexport { app, setDb };\n\n\n\n// WEBPACK FOOTER //\n// ./server/server.js"],"sourceRoot":""}